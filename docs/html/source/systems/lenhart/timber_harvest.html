<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>source.systems.lenhart.timber_harvest API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>source.systems.lenhart.timber_harvest</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from typing import Union, Optional
import gin

import jax.numpy as jnp
import matplotlib.pyplot as plt
import seaborn as sns
from source.systems import IndirectFHCS


@gin.configurable
class TimberHarvest(IndirectFHCS):
  def __init__(self, r=0., k=1., x_0=100., T=5.):
    &#34;&#34;&#34;
    Taken from: Optimal Control Applied to Biological Models, Lenhart &amp; Workman (Chapter 18, Lab 11)
    Additional information can be found in Morton I. Kamien and Nancy L. Schwartz. Dynamic Optimization:
    The Calculus of Variations and Optimal Control in Economics and Management. North-Holland, New York, 1991.

    This environment is an example of model where the cost is linear with respect to the control.
    It can still be solved by the FBSM algorithm since the optimal control are of the &#34;bang-bang&#34; type,
    i.e., it jumps from one boundary value to the other.

    In this problem we are trying to optimize tree harvesting in a timber farm, resulting in the production of
    raw timber (x(t)). The harvest percentage over the land is low enough that we can assume that there will always
    be sufficiently many mature trees ready for harvest. The timber is sold immediately after production,
    generating a income proportional to the production at every time t. The operators then have the choice of
    reinvesting a fraction of this revenue directly into the plant (u(t)), thus stimulating future production.
    But, this reinvestment comes at the price of losing potential interest over the period T if the
    revenue were saved. The control problem is therefore:

    .. math::

      \max_{u} \quad &amp;\int_0^T e^{-rt}x(t)[1 - u(t)] dt \\
      \mathrm{s.t.}\qquad &amp; x&#39;(t) = kx(t)u(t) ,\; x(0) &gt; 0 \\
      &amp; 0 \leq u(t) \leq 1

    :param r: Discount rate encouraging investment early on
    :param k: Return constant of reinvesting into the plant, taking into account cost of labor and land
    :param x_0: Initial raw timber production
    :param T: Horizon
    &#34;&#34;&#34;
    super().__init__(
      x_0=jnp.array([
        x_0,
      ]),                     # Starting state
      x_T=None,               # Terminal state, if any
      T=T,                    # Duration of experiment
      bounds=jnp.array([      # Bounds over the states (x_0, x_1 ...) are given first,
        [jnp.NINF, jnp.inf],  # followed by bounds over controls (u_0,u_1,...)
        [0, 1],
      ]),
      terminal_cost=False,
      discrete=False,
    )

    self.adj_T = None  # Final condition over the adjoint, if any
    self.r = r
    self.k = k

  def dynamics(self, x_t: jnp.ndarray, u_t: Union[float, jnp.ndarray],
              v_t: Optional[Union[float, jnp.ndarray]] = None, t: Optional[jnp.ndarray] = None) -&gt; jnp.ndarray:
    if u_t.ndim &gt; 0:
      u_t, = u_t
    d_x = jnp.array([
      self.k*x_t[0]*u_t
    ])

    return d_x

  def cost(self, x_t: jnp.ndarray, u_t: Union[float, jnp.ndarray], t: Optional[jnp.ndarray] = None) -&gt; float:
    return -jnp.exp(-self.r * t) * x_t[0] * (1 - u_t)  # Maximization problem converted to minimization

  def adj_ODE(self, adj_t: jnp.ndarray, x_t: Optional[jnp.ndarray], u_t: Optional[jnp.ndarray],
              t: Optional[jnp.ndarray]) -&gt; jnp.ndarray:
    return jnp.array([
      u_t[0] * (jnp.exp(-self.r * t[0]) - self.k * adj_t[0]) - jnp.exp(-self.r * t[0])
    ])

  def optim_characterization(self, adj_t: jnp.ndarray, x_t: Optional[jnp.ndarray],
                             t: Optional[jnp.ndarray]) -&gt; jnp.ndarray:
    # bang-bang scenario
    temp = x_t[:, 0]*(self.k*adj_t[:, 0] - jnp.exp(-self.r * t[:, 0]))
    char = jnp.sign(temp.reshape(-1, 1)) * 2 * jnp.max(jnp.abs(self.bounds[-1])) + jnp.max(jnp.abs(self.bounds[-1]))

    return jnp.minimum(self.bounds[-1, 1], jnp.maximum(self.bounds[-1, 0], char))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="source.systems.lenhart.timber_harvest.TimberHarvest"><code class="flex name class">
<span>class <span class="ident">TimberHarvest</span></span>
<span>(</span><span>r=0.0, k=1.0, x_0=100.0, T=5.0)</span>
</code></dt>
<dd>
<div class="desc"><p>Augment the base class for defining control problem under a finite horizon so that indirect methods can be use.
Model a problem of the form:
<span><span class="MathJax_Preview">\min_u \quad g_T(x_T,u_T,T) + \int_0^T g(x,u,t) dt</span><script type="math/tex; mode=display">\min_u \quad g_T(x_T,u_T,T) + \int_0^T g(x,u,t) dt</script></span>
<span><span class="MathJax_Preview">\mathrm{s.t.}\qquad \dot{x} = f(x,u,t)</span><script type="math/tex; mode=display">\mathrm{s.t.}\qquad \dot{x} = f(x,u,t)</script></span>
<span><span class="MathJax_Preview">x(0)=x_0</span><script type="math/tex; mode=display">x(0)=x_0</script></span></p>
<p>Taking into account the adjoint dynamics and the optimal characterization given by the Pontryagin's maximum principle</p>
<p>Taken from: Optimal Control Applied to Biological Models, Lenhart &amp; Workman (Chapter 18, Lab 11)
Additional information can be found in Morton I. Kamien and Nancy L. Schwartz. Dynamic Optimization:
The Calculus of Variations and Optimal Control in Economics and Management. North-Holland, New York, 1991.</p>
<p>This environment is an example of model where the cost is linear with respect to the control.
It can still be solved by the FBSM algorithm since the optimal control are of the "bang-bang" type,
i.e., it jumps from one boundary value to the other.</p>
<p>In this problem we are trying to optimize tree harvesting in a timber farm, resulting in the production of
raw timber (x(t)). The harvest percentage over the land is low enough that we can assume that there will always
be sufficiently many mature trees ready for harvest. The timber is sold immediately after production,
generating a income proportional to the production at every time t. The operators then have the choice of
reinvesting a fraction of this revenue directly into the plant (u(t)), thus stimulating future production.
But, this reinvestment comes at the price of losing potential interest over the period T if the
revenue were saved. The control problem is therefore:</p>
<p><span><span class="MathJax_Preview"> \max_{u} \quad &amp;\int_0^T e^{-rt}x(t)[1 - u(t)] dt \
\mathrm{s.t.}\qquad &amp; x'(t) = kx(t)u(t) ,\; x(0) &gt; 0 \
&amp; 0 \leq u(t) \leq 1 </span><script type="math/tex; mode=display"> \max_{u} \quad &\int_0^T e^{-rt}x(t)[1 - u(t)] dt \
\mathrm{s.t.}\qquad & x'(t) = kx(t)u(t) ,\; x(0) > 0 \
& 0 \leq u(t) \leq 1 </script></span>
:param r: Discount rate encouraging investment early on
:param k: Return constant of reinvesting into the plant, taking into account cost of labor and land
:param x_0: Initial raw timber production
:param T: Horizon</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class TimberHarvest(IndirectFHCS):
  def __init__(self, r=0., k=1., x_0=100., T=5.):
    &#34;&#34;&#34;
    Taken from: Optimal Control Applied to Biological Models, Lenhart &amp; Workman (Chapter 18, Lab 11)
    Additional information can be found in Morton I. Kamien and Nancy L. Schwartz. Dynamic Optimization:
    The Calculus of Variations and Optimal Control in Economics and Management. North-Holland, New York, 1991.

    This environment is an example of model where the cost is linear with respect to the control.
    It can still be solved by the FBSM algorithm since the optimal control are of the &#34;bang-bang&#34; type,
    i.e., it jumps from one boundary value to the other.

    In this problem we are trying to optimize tree harvesting in a timber farm, resulting in the production of
    raw timber (x(t)). The harvest percentage over the land is low enough that we can assume that there will always
    be sufficiently many mature trees ready for harvest. The timber is sold immediately after production,
    generating a income proportional to the production at every time t. The operators then have the choice of
    reinvesting a fraction of this revenue directly into the plant (u(t)), thus stimulating future production.
    But, this reinvestment comes at the price of losing potential interest over the period T if the
    revenue were saved. The control problem is therefore:

    .. math::

      \max_{u} \quad &amp;\int_0^T e^{-rt}x(t)[1 - u(t)] dt \\
      \mathrm{s.t.}\qquad &amp; x&#39;(t) = kx(t)u(t) ,\; x(0) &gt; 0 \\
      &amp; 0 \leq u(t) \leq 1

    :param r: Discount rate encouraging investment early on
    :param k: Return constant of reinvesting into the plant, taking into account cost of labor and land
    :param x_0: Initial raw timber production
    :param T: Horizon
    &#34;&#34;&#34;
    super().__init__(
      x_0=jnp.array([
        x_0,
      ]),                     # Starting state
      x_T=None,               # Terminal state, if any
      T=T,                    # Duration of experiment
      bounds=jnp.array([      # Bounds over the states (x_0, x_1 ...) are given first,
        [jnp.NINF, jnp.inf],  # followed by bounds over controls (u_0,u_1,...)
        [0, 1],
      ]),
      terminal_cost=False,
      discrete=False,
    )

    self.adj_T = None  # Final condition over the adjoint, if any
    self.r = r
    self.k = k

  def dynamics(self, x_t: jnp.ndarray, u_t: Union[float, jnp.ndarray],
              v_t: Optional[Union[float, jnp.ndarray]] = None, t: Optional[jnp.ndarray] = None) -&gt; jnp.ndarray:
    if u_t.ndim &gt; 0:
      u_t, = u_t
    d_x = jnp.array([
      self.k*x_t[0]*u_t
    ])

    return d_x

  def cost(self, x_t: jnp.ndarray, u_t: Union[float, jnp.ndarray], t: Optional[jnp.ndarray] = None) -&gt; float:
    return -jnp.exp(-self.r * t) * x_t[0] * (1 - u_t)  # Maximization problem converted to minimization

  def adj_ODE(self, adj_t: jnp.ndarray, x_t: Optional[jnp.ndarray], u_t: Optional[jnp.ndarray],
              t: Optional[jnp.ndarray]) -&gt; jnp.ndarray:
    return jnp.array([
      u_t[0] * (jnp.exp(-self.r * t[0]) - self.k * adj_t[0]) - jnp.exp(-self.r * t[0])
    ])

  def optim_characterization(self, adj_t: jnp.ndarray, x_t: Optional[jnp.ndarray],
                             t: Optional[jnp.ndarray]) -&gt; jnp.ndarray:
    # bang-bang scenario
    temp = x_t[:, 0]*(self.k*adj_t[:, 0] - jnp.exp(-self.r * t[:, 0]))
    char = jnp.sign(temp.reshape(-1, 1)) * 2 * jnp.max(jnp.abs(self.bounds[-1])) + jnp.max(jnp.abs(self.bounds[-1]))

    return jnp.minimum(self.bounds[-1, 1], jnp.maximum(self.bounds[-1, 0], char))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="source.systems.base.IndirectFHCS" href="../base.html#source.systems.base.IndirectFHCS">IndirectFHCS</a></li>
<li><a title="source.systems.base.FiniteHorizonControlSystem" href="../base.html#source.systems.base.FiniteHorizonControlSystem">FiniteHorizonControlSystem</a></li>
<li>abc.ABC</li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="source.systems.base.IndirectFHCS" href="../base.html#source.systems.base.IndirectFHCS">IndirectFHCS</a></b></code>:
<ul class="hlist">
<li><code><a title="source.systems.base.IndirectFHCS.T" href="../base.html#source.systems.base.FiniteHorizonControlSystem.T">T</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.adj_ODE" href="../base.html#source.systems.base.IndirectFHCS.adj_ODE">adj_ODE</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.adj_T" href="../base.html#source.systems.base.IndirectFHCS.adj_T">adj_T</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.bounds" href="../base.html#source.systems.base.FiniteHorizonControlSystem.bounds">bounds</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.cost" href="../base.html#source.systems.base.FiniteHorizonControlSystem.cost">cost</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.discrete" href="../base.html#source.systems.base.FiniteHorizonControlSystem.discrete">discrete</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.dynamics" href="../base.html#source.systems.base.FiniteHorizonControlSystem.dynamics">dynamics</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.guess_a" href="../base.html#source.systems.base.IndirectFHCS.guess_a">guess_a</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.guess_b" href="../base.html#source.systems.base.IndirectFHCS.guess_b">guess_b</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.optim_characterization" href="../base.html#source.systems.base.IndirectFHCS.optim_characterization">optim_characterization</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.plot_solution" href="../base.html#source.systems.base.FiniteHorizonControlSystem.plot_solution">plot_solution</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.terminal_cost" href="../base.html#source.systems.base.FiniteHorizonControlSystem.terminal_cost">terminal_cost</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.terminal_cost_fn" href="../base.html#source.systems.base.FiniteHorizonControlSystem.terminal_cost_fn">terminal_cost_fn</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.x_0" href="../base.html#source.systems.base.FiniteHorizonControlSystem.x_0">x_0</a></code></li>
<li><code><a title="source.systems.base.IndirectFHCS.x_T" href="../base.html#source.systems.base.FiniteHorizonControlSystem.x_T">x_T</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="source.systems.lenhart" href="index.html">source.systems.lenhart</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="source.systems.lenhart.timber_harvest.TimberHarvest" href="#source.systems.lenhart.timber_harvest.TimberHarvest">TimberHarvest</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>